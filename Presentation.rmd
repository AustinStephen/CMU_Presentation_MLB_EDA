---
title: "MLB 2021 Batted Balls EDA"
author: "Austin, Advaith and Claire"
date: "6/14/2021"
output:
  xaringan::moon_reader:
    css: xaringan-themer.css
    
---

```{r setup, include=FALSE}
library(tidyverse)
library(baseballr)
library(gt)
library(evaluate)
library(cluster)
options(htmltools.dir.version = FALSE)
knitr::opts_chunk$set(
	echo = TRUE,
	fig.height = 3.5,
	fig.retina = 3,
	fig.show = TRUE,
	fig.width = 9,
	message = FALSE,
	warning = FALSE,
	cache = FALSE,
	hiline = TRUE,
	out.width = "100%"
)
```

```{r xaringan-themer, include=FALSE, warning=FALSE }
library(xaringanthemer)
style_mono_accent(base_color = "#808080",
  white_color = "#FFFFFF",
  background_color = "#fff7e6",
  base_font_size = "24px")
```

```{r inlcude=FALSE, warning=FALSE, echo=FALSE, cache=TRUE}

# Setting up all of the data used below 
# read in the base data
mlb_batted_balls_2021 <- read.csv("./data/2021_current_data.csv")

# filtering for data points of interest
mlb_batted_balls_2021 <- mlb_batted_balls_2021 %>%
  # Only select columns regarding the batted ball with discrete pitch type
  # information (except for the speed) for now: 
  dplyr::select(# Batter info:
                player_name, batter, stand, 
                # Batted ball info:
                events, hc_x, hc_y, hit_distance_sc, launch_speed, launch_angle,
                hit_location, bb_type, barrel,
                # Pitch info:
                pitch_type, release_speed, effective_speed, pitcher,
                # Shift info:
                if_fielding_alignment, of_fielding_alignment,
                # Game level context:
                game_date, balls, strikes, outs_when_up, on_1b, on_2b, on_3b,
                inning, inning_topbot, home_score, away_score, post_home_score,
                post_away_score, home_team, away_team,
                # Description of play:
                des)

## Removing data points where hit distance or launch angle are NA
mlb_batted_balls_2021 <- mlb_batted_balls_2021 %>% drop_na(launch_angle)
mlb_batted_balls_2021 <- mlb_batted_balls_2021 %>% drop_na(hit_distance_sc)


## Important subsets of data for reuse in various plots

mlb_batted_balls_2021 <- mlb_batted_balls_2021 %>%
  mutate(bases_covered = case_when(
              events == "single" ~ 1,
              events == "double" ~ 2,
              events == "triple" ~ 3,
              events == "home_run" ~ 4,
              TRUE ~ 0)
  )

## Current top 5
subset_top_5_hr <- mlb_batted_balls_2021 %>% 
      filter(player_name %in% c("Haniger, Mitch",
                            "Winker, Jesse",
                            "Acuña Jr., Ronald", 
                            "García, Adolis", 
                            "Guerrero Jr., Vladimir"))
mlb_batted_balls_2021 <- as.data.frame(mlb_batted_balls_2021)
  

# More broad pitching categories 
consolidated_pitch_types <- mlb_batted_balls_2021 %>% 
  mutate(pitch_type = as.character(pitch_type),
         pitch_type = case_when(
            pitch_type == "FA" ~ "F",
            pitch_type == "FF" ~ "F",
            pitch_type == "FT" ~ "F",
            pitch_type == "FC" ~ "F",
            pitch_type == "FS" ~ "F",
            pitch_type == "SI" ~ "F",
            pitch_type == "FO" ~ "F",
            pitch_type == "CU" ~ "BB",
            pitch_type == "CS" ~ "BB",
            pitch_type == "SC" ~ "BB",
            pitch_type == "KC" ~ "BB",
            pitch_type == "SL" ~ "BB",
            pitch_type == "KN" ~ "CH",
            pitch_type == "EP" ~ "CH",
            TRUE ~ pitch_type
          )) 

## Summary stats by hitter
summary_stats_by_hitter <- mlb_batted_balls_2021 %>% 
  group_by(player_name) %>% 
  summarise(total_hr = sum(events == "home_run"), 
            total_triples = sum(events == "triple"),
            total_doubles= sum(events == "double"),
            total_singles = sum(events == "single"),
            total_bases_taken = sum(bases_covered),
            total_hit_distance = sum(hit_distance_sc),
            total_hits = sum(batter == batter)
            )

## Summary stats by pitcher
summary_stats_by_pitcher <- mlb_batted_balls_2021 %>% 
  group_by(pitcher) %>% 
  summarise(total_hr = sum(events == "home_run"), 
            total_triples = sum(events == "triple"),
            total_doubles= sum(events == "double"),
            total_singles = sum(events == "single"),
            total_bases_given = sum(bases_covered),
            total_hit_distance = sum(hit_distance_sc),
            average_release_speed = mean(release_speed),
            total_pitches_hit = sum(pitcher == pitcher)
            )

# Setting up clustering data set

# selecting only batters with over 15 at bats
better_players <- mlb_batted_balls_2021 %>%
  group_by(player_name) %>% 
  mutate(atbats = n()) 

better_players <- better_players %>%
  filter(atbats > 15)

# scatterplot of launch angle versus hit distance



```

class: left, top
## MLB Batted Balls Data
* Exclusively 2021 season data 
* Excludes any outcome that is not a hit
* Exploring different conditions after the hit influence outcomes
* Important for understanding how the game proceeds without 


???
All of our exploration can be put under the umbrella of how different conditions 
in the game impact play outcome. We explore this through 3 hypothesis and a clustering 
example.


---

## The Data 

* Every batted ball from the 2021 season  


* Summaries by batter 

* Summaries by pitcher 

???
I want it to reveal 1 at a time summary table for pitcher and batters
---

## Hit Location 
* How does hit location influence bases taken?  
(insert code)
* How does batters handedness influence hit location?  
(insert code)
---

## Bases Taken
* How is hit distance distributed?  
(insert code)

* Bases taken as a function of hit distance?  
(insert code)

* Who is the most efficient base runner this year?  
(insert code)

---

## Stadiums and hitting
* Advaith fill in here!
---

## Clustering 
* What is the ideal launch angle for a batted ball?
```{r echo = FALSE}
better_players %>%
  ggplot(aes(x = launch_angle,
             y = hit_distance_sc)) + 
  geom_point() +
  theme_minimal()
```
---

```{r echo = FALSE}
better_players %>%
   filter(effective_speed > 60) %>%
  ggplot(aes(x = launch_angle,
             y = hit_distance_sc,
             color = bb_type)) + 
  geom_point() +
  ggthemes::scale_color_colorblind() +
  theme_minimal()
```

---

## Clustering
```{r echo = FALSE}
better_players %>%
   filter(effective_speed > 60,
          events %in% (c("single", "triple", "double", "home_run"))) %>%
  ggplot(aes(x = launch_angle,
             y = hit_distance_sc,
             color = events)) + 
  geom_point() +
  ggthemes::scale_color_colorblind() +
  theme_minimal()
```
---


---
## Conclusion Slide 




